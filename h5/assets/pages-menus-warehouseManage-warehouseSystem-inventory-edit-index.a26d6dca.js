import{aF as e,aG as a,aH as l,ap as t,aq as r,F as s,G as o,H as i,K as u,P as n,_ as m,I as c,ar as d,O as p,L as f,M as h,N as y,af as g,S as _,d as C,a as D,z as S,D as v,aI as k,r as b,ag as V,at as N,X as x,aJ as I,aD as M,T as w,aK as P,V as B}from"./index.94028eaa.js";import{_ as R}from"./uni-icons.29799ac0.js";import{_ as U,a as $,b as T}from"./uni-forms.7ac88b8a.js";import{o as F}from"./uni-cloud.es.e8536f14.js";import{_ as j}from"./plugin-vue_export-helper.21dcd24c.js";import{_ as J}from"./uni-search-bar.f5b39437.js";import{_ as q}from"./uni-popup.331ab2e7.js";import{g as z,b as E,a as L,c as O,u as W,e as A}from"./business.e4d8c1ca.js";var G=j({name:"uni-stat-select",mixins:[F.mixinDatacom||{}],data:()=>({showSelector:!1,current:"",mixinDatacomResData:[],apps:[],channels:[]}),props:{localdata:{type:Array,default:()=>[]},value:{type:[String,Number],default:""},modelValue:{type:[String,Number],default:""},label:{type:String,default:""},placeholder:{type:String,default:"请选择"},emptyTips:{type:String,default:"无选项"},clear:{type:Boolean,default:!0},defItem:{type:Number,default:0},disabled:{type:Boolean,default:!1},format:{type:String,default:""}},created(){this.last=`${this.collection}_last_selected_option_value`,this.collection&&!this.localdata.length&&this.query()},computed:{typePlaceholder(){const e=this.placeholder,a={"opendb-stat-app-versions":"版本","opendb-app-channels":"渠道","opendb-app-list":"应用"}[this.collection];return a?e+a:e}},watch:{localdata:{immediate:!0,handler(e,a){Array.isArray(e)&&a!==e&&(this.mixinDatacomResData=e)}},modelValue(){this.initDefVal()},mixinDatacomResData:{immediate:!0,handler(e){e.length&&this.initDefVal()}}},methods:{query(){this.mixinDatacomEasyGet()},onMixinDatacomPropsChange(){this.collection&&this.query()},initDefVal(){let a="";if(!this.value&&0!==this.value||this.isDisabled(this.value))if(!this.modelValue&&0!==this.modelValue||this.isDisabled(this.modelValue)){let l;if(this.collection&&(l=e(this.last)),l||0===l)a=l;else{let e="";this.defItem>0&&this.defItem<=this.mixinDatacomResData.length&&(e=this.mixinDatacomResData[this.defItem-1].value),a=e}(a||0===a)&&this.emit(a)}else a=this.modelValue;else a=this.value;const l=this.mixinDatacomResData.find((e=>e.value===a));this.current=l?this.formatItemName(l):""},isDisabled(e){let a=!1;return this.mixinDatacomResData.forEach((l=>{l.value===e&&(a=l.disable)})),a},clearVal(){this.emit(""),this.collection&&a(this.last)},change(e){e.disable||(this.showSelector=!1,this.current=this.formatItemName(e),this.emit(e.value))},emit(e){this.$emit("change",e),this.$emit("input",e),this.$emit("update:modelValue",e),this.collection&&l(this.last,e)},toggleSelector(){this.disabled||(this.showSelector=!this.showSelector)},formatItemName(e){let{text:a,value:l,channel_code:t}=e;if(t=t?`(${t})`:"",this.format){let a="";a=this.format;for(let l in e)a=a.replace(new RegExp(`{${l}}`,"g"),e[l]);return a}return this.collection.indexOf("app-list")>0?`${a}(${l})`:a||`未命名${t}`}}},[["render",function(e,a,l,C,D,S){const v=y,k=t(r("uni-icons"),R),b=g,V=_;return s(),o(v,{class:"uni-stat__select"},{default:i((()=>[l.label?(s(),u("span",{key:0,class:"uni-label-text hide-on-phone"},n(l.label+"："),1)):m("",!0),c(v,{class:d(["uni-stat-box",{"uni-stat__actived":D.current}])},{default:i((()=>[c(v,{class:d(["uni-select",{"uni-select--disabled":l.disabled}])},{default:i((()=>[c(v,{class:"uni-select__input-box",onClick:S.toggleSelector},{default:i((()=>[D.current?(s(),o(v,{key:0,class:"uni-select__input-text"},{default:i((()=>[p(n(D.current),1)])),_:1})):(s(),o(v,{key:1,class:"uni-select__input-text uni-select__input-placeholder"},{default:i((()=>[p(n(S.typePlaceholder),1)])),_:1})),D.current&&l.clear?(s(),o(k,{key:2,type:"clear",color:"#c0c4cc",size:"24",onClick:S.clearVal},null,8,["onClick"])):(s(),o(k,{key:3,type:D.showSelector?"top":"bottom",size:"14",color:"#999"},null,8,["type"]))])),_:1},8,["onClick"]),D.showSelector?(s(),o(v,{key:0,class:"uni-select--mask",onClick:S.toggleSelector},null,8,["onClick"])):m("",!0),D.showSelector?(s(),o(v,{key:1,class:"uni-select__selector"},{default:i((()=>[c(v,{class:"uni-popper__arrow"}),c(V,{"scroll-y":"true",class:"uni-select__selector-scroll"},{default:i((()=>[0===D.mixinDatacomResData.length?(s(),o(v,{key:0,class:"uni-select__selector-empty"},{default:i((()=>[c(b,null,{default:i((()=>[p(n(l.emptyTips),1)])),_:1})])),_:1})):(s(!0),u(h,{key:1},f(D.mixinDatacomResData,((e,a)=>(s(),o(v,{class:"uni-select__selector-item",key:a,onClick:a=>S.change(e)},{default:i((()=>[c(b,{class:d({"uni-select__selector__disabled":e.disable})},{default:i((()=>[p(n(S.formatItemName(e)),1)])),_:2},1032,["class"])])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})):m("",!0)])),_:1},8,["class"])])),_:1},8,["class"])])),_:1})}],["__scopeId","data-v-4668d795"]]);const H=[{text:"月",value:"月"},{text:"天",value:"天"},{text:"时",value:"时"}],K={largerCategoryCode:"",largerCategoryId:"",materialBrand:"",materialPeriod:"",materialPeriodUnit:"",materialSpecJson:[],mediumCategoryCode:"",mediumCategoryId:"",remark:"",securityWarehouseNum:"",smallCategoryCode:"",smallCategoryId:"",supplierName:"",materialSpec:"",materialTexture:""},X={smallCategoryId:{rules:[{required:!0,errorMessage:"物料小类不能为空",validateTrigger:"bind"}]},materialSpec:{rules:[{required:!0,errorMessage:"物料规格不能为空",validateTrigger:"bind"}]}},Q=[{name:"物料小类",value:"smallCategoryValue",unit:!0},{name:"规格",value:"materialSpec",render:L},{name:"材质",value:"materialTexture",render:L},{name:"物料中类",value:"mediumCategoryValue",unit:!0},{name:"物料大类",value:"largerCategoryValue",unit:!0},{name:"单位",value:"measureUnit"}];var Y=j(C({name:"InventoryEdit",props:{type:{type:String,default:"add"},id:{type:String,default:""}},setup(e){const a=D({formData:K,type:e.type});S((()=>{l()})),v((()=>{for(const[e]of Object.entries(K))K[e]="materialSpecJson"===e?[]:""}));const l=async()=>{k({title:"modify"===e.type?"修改物料":"添加物料"}),i(),"modify"===e.type&&await t()},t=()=>{const l={materialManagerId:e.id};return new Promise(((e,t)=>{z(l).then((l=>{l.success&&(a.formData=l.data,l.data.materialSpecJson.includes("-")?(a.formData.materialSpec=l.data.materialSpecJson.split("-")[1],a.formData.materialTexture=l.data.materialSpecJson.split("-")[0]):a.formData.materialSpec=l.data.materialSpecJson),e(l)})).catch((e=>{throw t(),new Error(e)}))}))},r=b([]),s=b(""),o=V((()=>r.value.filter((e=>e.name.includes(s.value))))),i=()=>new Promise(((e,a)=>{E().then((a=>{a.success&&(r.value=a.data),e(a)})).catch((e=>{throw a(),new Error(e)}))})),u=b(null),n=b({}),m=e=>{u.value[e?"open":"close"]()},c=b([]),d=b(""),p=V((()=>c.value.filter((e=>e.includes(d.value))))),f=b(null),h=b(""),y=e=>{f.value[e?"open":"close"]()},g=b(null),_=()=>{const e=r.value.find((e=>e.smallCategoryId===a.formData.smallCategoryId));if(e)for(const[t,r]of Object.entries(e))"name"!==t&&(a.formData[t]=r);const l=JSON.parse(JSON.stringify(a.formData));return l.materialSpecJson=`${a.formData.materialTexture}${a.formData.materialTexture?"-":""}${a.formData.materialSpec}`,l},C=()=>{const{materialBrand:e,materialManagerId:l,materialPeriod:t,materialPeriodUnit:r,remark:s,securityWarehouseNum:o,supplierName:i}=a.formData;return{materialBrand:e,materialManagerId:l,materialPeriod:t,materialPeriodUnit:r,remark:s,securityWarehouseNum:o,supplierName:i}};return{...N(a),units:H,formRules:X,formRef:g,popupRef:u,popupMaterialRef:f,smallCategoryNameList:o,searchSmallCategoryName:s,currenSmallCategory:n,currenSmallMaterial:h,handleSmallCategoryClick:e=>{var l;l=e.smallCategoryId,A({smallCategoryId:l}).then((e=>{e.success&&(c.value=e.data,console.log(c.value),console.log(p))})).catch((e=>{throw new Error(e)})),g.value.setValue("smallCategoryId",e.smallCategoryId),a.formData.smallCategoryId=e.smallCategoryId,n.value=e,m(!1)},handleSmallMaterialClick:e=>{a.formData.materialTexture=e,h.value=e,y(!1)},searchSmallMaterialName:d,smallMaterialNameList:p,handleSave:()=>{g.value.validate().then((()=>{x({title:"提示",content:"确定提交物料信息？",success:function(a){if(a.confirm){I({title:"提交中"});const a="add"===e.type?_():C();console.log(a);("add"===e.type?O:W)(a).then((e=>{e.success?(M({title:"提交成功",icon:"success"}),w.navigateTo("/pages/menus/warehouseManage/warehouseSystem/index")):M({title:e.message,icon:"none",duration:2e3})})).catch((e=>{throw P(),new Error(e)}))}else a.cancel&&console.log("用户点击取消")}})}))},togglePopup:m,toggleMaterialPopup:y,genDynamicFormProp:e=>`materialSpecJson.${e}.inputVal`,genDynamicFormRules:({isRequired:e,name:a,type:l})=>[{required:e,errorMessage:`${a}不能为空`}],handlePickerChange:({detail:{value:e}},a)=>{a.inputSubmitVal=e.map((e=>e.value)).join(",")},fields:Q,getCategoryName:(e,a)=>e?e.split("|")[a]:"--"}}}),[["render",function(e,a,l,_,C,D){const S=g,v=y,k=t(r("uni-icons"),R),b=t(r("uni-forms-item"),U),V=t(r("uni-easyinput"),$),N=t(r("uni-data-select"),G),x=t(r("uni-forms"),T),I=B,M=t(r("uni-search-bar"),J),w=t(r("uni-popup"),q);return s(),o(v,{class:"inventory-edite-container uni-forms-reset"},{default:i((()=>["modify"===e.type?(s(),u(h,{key:0},[c(v,{class:"header"},{default:i((()=>[c(v,{class:"tips"},{default:i((()=>[c(S,{class:"left"},{default:i((()=>[p("物料编码(自动生成)")])),_:1})])),_:1}),c(v,{class:"code"},{default:i((()=>[p(n(e.formData.materialCode),1)])),_:1})])),_:1}),c(v,{class:"base-info-section"},{default:i((()=>[(s(!0),u(h,null,f(e.fields,(a=>(s(),o(v,{key:a.value,class:"item"},{default:i((()=>[c(S,{class:"label"},{default:i((()=>[p(n(a.name),1)])),_:2},1024),a.render?(s(),o(S,{key:0,class:"vlaue"},{default:i((()=>[p(n(a.render(e.formData[a.value])),1)])),_:2},1024)):(s(),o(S,{key:1,class:"vlaue"},{default:i((()=>[p(n(a.unit?e.getCategoryName(e.formData[a.value],0):e.formData[a.value]||"--"),1)])),_:2},1024)),a.unit?(s(),o(S,{key:2,class:"unit"},{default:i((()=>[p(n(e.getCategoryName(e.formData[a.value],1)),1)])),_:2},1024)):m("",!0)])),_:2},1024)))),128))])),_:1})],64)):m("",!0),c(x,{ref:"formRef",modelValue:e.formData,rules:e.formRules},{default:i((()=>["add"===e.type?(s(),o(b,{key:0,label:"物料小类",required:"",name:"smallCategoryId"},{default:i((()=>[c(v,{class:d({select:!0,"not-value":!e.currenSmallCategory.name}),onClick:a[0]||(a[0]=a=>e.togglePopup(!0))},{default:i((()=>[c(S,{class:"name"},{default:i((()=>[p(n(e.currenSmallCategory.name),1)])),_:1}),c(S,null,{default:i((()=>[c(k,{type:"forward",size:"14",color:"#BFBFBF"})])),_:1})])),_:1},8,["class"])])),_:1})):m("",!0),"add"===e.type?(s(),o(b,{key:1,label:"物料规格",name:"materialSpec",required:""},{default:i((()=>[c(V,{modelValue:e.formData.materialSpec,"onUpdate:modelValue":a[1]||(a[1]=a=>e.formData.materialSpec=a),inputBorder:!1,clearable:!1,placeholder:"请输入物料规格"},null,8,["modelValue"])])),_:1})):m("",!0),"add"===e.type&&e.smallMaterialNameList.length?(s(),o(b,{key:2,label:"物料材质",name:"materialTexture"},{default:i((()=>[c(v,{class:d({select:!0,"not-value":!e.currenSmallMaterial}),onClick:a[2]||(a[2]=a=>e.toggleMaterialPopup(!0))},{default:i((()=>[c(S,{class:"name"},{default:i((()=>[p(n(e.currenSmallMaterial),1)])),_:1}),c(S,null,{default:i((()=>[c(k,{type:"forward",size:"14",color:"#BFBFBF"})])),_:1})])),_:1},8,["class"])])),_:1})):m("",!0),c(b,{label:"安全库存",name:"securityWarehouseNum"},{default:i((()=>[c(V,{modelValue:e.formData.securityWarehouseNum,"onUpdate:modelValue":a[3]||(a[3]=a=>e.formData.securityWarehouseNum=a),inputBorder:!1,clearable:!1,placeholder:"请输入安全库存"},null,8,["modelValue"])])),_:1}),c(b,{label:"有效期",name:"materialPeriod"},{default:i((()=>[c(v,{class:"m-row"},{default:i((()=>[c(V,{modelValue:e.formData.materialPeriod,"onUpdate:modelValue":a[4]||(a[4]=a=>e.formData.materialPeriod=a),inputBorder:!1,clearable:!1,placeholder:"请输入有效期"},null,8,["modelValue"]),c(N,{modelValue:e.formData.materialPeriodUnit,"onUpdate:modelValue":a[5]||(a[5]=a=>e.formData.materialPeriodUnit=a),localdata:e.units,class:"unit",placeholder:"单位",clear:!1},null,8,["modelValue","localdata"])])),_:1})])),_:1}),c(b,{label:"品牌",name:"materialBrand"},{default:i((()=>[c(V,{modelValue:e.formData.materialBrand,"onUpdate:modelValue":a[6]||(a[6]=a=>e.formData.materialBrand=a),inputBorder:!1,clearable:!1,placeholder:"请输入品牌"},null,8,["modelValue"])])),_:1}),c(b,{label:"供应商",name:"supplierName"},{default:i((()=>[c(V,{modelValue:e.formData.supplierName,"onUpdate:modelValue":a[7]||(a[7]=a=>e.formData.supplierName=a),inputBorder:!1,clearable:!1,placeholder:"请输入供应商"},null,8,["modelValue"])])),_:1}),c(b,{label:"备注",name:"remark"},{default:i((()=>[c(V,{modelValue:e.formData.remark,"onUpdate:modelValue":a[8]||(a[8]=a=>e.formData.remark=a),inputBorder:!1,clearable:!1,placeholder:"请输入备注"},null,8,["modelValue"])])),_:1})])),_:1},8,["modelValue","rules"]),c(I,{class:"btn-primary",style:{"margin-top":"15px"},onClick:e.handleSave},{default:i((()=>[p("提交")])),_:1},8,["onClick"]),c(w,{ref:"popupRef","background-color":"#fff",type:"bottom"},{default:i((()=>[c(v,{class:"material-popup-warpper"},{default:i((()=>[c(v,{class:"header"},{default:i((()=>[c(S,{class:"title"},{default:i((()=>[p("物料小类")])),_:1}),c(S,{onClick:a[9]||(a[9]=a=>e.togglePopup(!1))},{default:i((()=>[c(k,{type:"closeempty",size:"16"})])),_:1})])),_:1}),c(v,{class:"search-section"},{default:i((()=>[c(M,{modelValue:e.searchSmallCategoryName,"onUpdate:modelValue":a[10]||(a[10]=a=>e.searchSmallCategoryName=a),cancelButton:"none",placeholder:"请输入物料名称"},null,8,["modelValue"])])),_:1}),c(v,{class:"main"},{default:i((()=>[e.smallCategoryNameList.length?(s(!0),u(h,{key:0},f(e.smallCategoryNameList,(a=>(s(),o(v,{class:d({item:!0,active:e.currenSmallCategory.smallCategoryId===a.smallCategoryId}),key:a.smallCategoryId,onClick:l=>e.handleSmallCategoryClick(a)},{default:i((()=>[c(S,null,{default:i((()=>[p(n(a.name),1)])),_:2},1024),e.currenSmallCategory.smallCategoryId===a.smallCategoryId?(s(),o(S,{key:0,class:"icon"},{default:i((()=>[c(k,{type:"checkmarkempty",size:"18",color:"#3A78F4"})])),_:1})):m("",!0)])),_:2},1032,["class","onClick"])))),128)):(s(),o(v,{key:1,class:"not-found"},{default:i((()=>[p(" 未找到 "),c(S,null,{default:i((()=>[p("“"+n(e.searchSmallCategoryName)+"“",1)])),_:1}),p(" 材料 ")])),_:1}))])),_:1})])),_:1})])),_:1},512),c(w,{ref:"popupMaterialRef","background-color":"#fff",type:"bottom"},{default:i((()=>[c(v,{class:"material-popup-warpper"},{default:i((()=>[c(v,{class:"header"},{default:i((()=>[c(S,{class:"title"},{default:i((()=>[p("物料材质")])),_:1}),c(S,{onClick:a[11]||(a[11]=a=>e.toggleMaterialPopup(!1))},{default:i((()=>[c(k,{type:"closeempty",size:"16"})])),_:1})])),_:1}),c(v,{class:"search-section"},{default:i((()=>[c(M,{modelValue:e.searchSmallMaterialName,"onUpdate:modelValue":a[12]||(a[12]=a=>e.searchSmallMaterialName=a),cancelButton:"none",placeholder:"请输入材质名称"},null,8,["modelValue"])])),_:1}),c(v,{class:"main"},{default:i((()=>[e.smallMaterialNameList.length?(s(!0),u(h,{key:0},f(e.smallMaterialNameList,(a=>(s(),o(v,{class:d({item:!0,active:e.currenSmallMaterial===a}),key:a,onClick:l=>e.handleSmallMaterialClick(a)},{default:i((()=>[c(S,null,{default:i((()=>[p(n(a),1)])),_:2},1024),e.currenSmallMaterial===a?(s(),o(S,{key:0,class:"icon"},{default:i((()=>[c(k,{type:"checkmarkempty",size:"18",color:"#3A78F4"})])),_:1})):m("",!0)])),_:2},1032,["class","onClick"])))),128)):(s(),o(v,{key:1,class:"not-found"},{default:i((()=>[p(" 未找到 "),c(S,null,{default:i((()=>[p("“"+n(e.searchSmallMaterialName)+"“",1)])),_:1}),p(" 材料 ")])),_:1}))])),_:1})])),_:1})])),_:1},512)])),_:1})}],["__scopeId","data-v-6b8180e4"]]);export{Y as default};
