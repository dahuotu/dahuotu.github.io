import{am as e,aO as a,aP as l,aD as t,ae as s,an as i,F as r,G as o,H as d,K as u,L as n,Z as c,I as h,au as m,_ as p,O as f,M as g,aA as y,R as b,N as w,aY as k,ar as S,P as _,ac as v,af as M,V as F,d as I,r as C,a as A,ag as x,aZ as P,as as N,aI as V,a_ as T,aB as L,ai as B,T as U,at as D,J as $,aj as W,ap as E,aq as O}from"./index.94028eaa.js";import{_ as j}from"./uni-icons.29799ac0.js";import{_ as R,a as z,b as G}from"./uni-forms.7ac88b8a.js";import{_ as Q}from"./uni-datetime-picker.97ef656b.js";import{o as Y}from"./uni-cloud.es.e8536f14.js";import{_ as K}from"./plugin-vue_export-helper.21dcd24c.js";import{_ as q}from"./uni-search-bar.f5b39437.js";import{_ as Z}from"./uni-popup.331ab2e7.js";import{_ as J}from"./uni-segmented-control.6690164e.js";const H="chooseAndUploadFile:fail";function X(e,a){return e.tempFiles.forEach(((e,l)=>{e.name||(e.name=e.path.substring(e.path.lastIndexOf("/")+1)),a&&(e.fileType=a),e.cloudPath=Date.now()+"_"+l+e.name.substring(e.name.lastIndexOf("."))})),e.tempFilePaths||(e.tempFilePaths=e.tempFiles.map((e=>e.path))),e}function ee(e,a=5,l){const t=(e=JSON.parse(JSON.stringify(e))).length;let s=0,i=this;return new Promise((r=>{for(;s<a;)o();function o(){let a=s++;if(a>=t)return void(!e.find((e=>!e.url&&!e.errMsg))&&r(e));const d=e[a],u=i.files.findIndex((e=>e.uuid===d.uuid));d.url="",delete d.errMsg,Y.uploadFile({filePath:d.path,cloudPath:d.cloudPath,fileType:d.fileType,onUploadProgress:e=>{e.index=u,l&&l(e)}}).then((e=>{d.url=e.fileID,d.index=u,a<t&&o()})).catch((e=>{d.errMsg=e.errMsg||e.message,d.index=u,a<t&&o()}))}}))}function ae(e,{onChooseFile:a,onUploadProgress:l}){return e.then((e=>{if(a){const l=a(e);if(void 0!==l)return Promise.resolve(l).then((a=>void 0===a?e:a))}return e})).then((e=>!1===e?{errMsg:"chooseAndUploadFile:ok",tempFilePaths:[],tempFiles:[]}:e))}function le(t={type:"all"}){return"image"===t.type?ae(function(a){const{count:l,sizeType:t=["original","compressed"],sourceType:s,extension:i}=a;return new Promise(((a,r)=>{e({count:l,sizeType:t,sourceType:s,extension:i,success(e){a(X(e,"image"))},fail(e){r({errMsg:e.errMsg.replace("chooseImage:fail",H)})}})}))}(t),t):"video"===t.type?ae(function(e){const{camera:l,compressed:t,maxDuration:s,sourceType:i,extension:r}=e;return new Promise(((e,o)=>{a({camera:l,compressed:t,maxDuration:s,sourceType:i,extension:r,success(a){const{tempFilePath:l,duration:t,size:s,height:i,width:r}=a;e(X({errMsg:"chooseVideo:ok",tempFilePaths:[l],tempFiles:[{name:a.tempFile&&a.tempFile.name||"",path:l,size:s,type:a.tempFile&&a.tempFile.type||"",width:r,height:i,duration:t,fileType:"video",cloudPath:""}]},"video"))},fail(e){o({errMsg:e.errMsg.replace("chooseVideo:fail",H)})}})}))}(t),t):ae(function(e){const{count:a,extension:t}=e;return new Promise(((e,s)=>{let i=l;if("undefined"!=typeof wx&&"function"==typeof wx.chooseMessageFile&&(i=wx.chooseMessageFile),"function"!=typeof i)return s({errMsg:H+" 请指定 type 类型，该平台仅支持选择 image 或 video。"});i({type:"all",count:a,extension:t,success(a){e(X(a))},fail(e){s({errMsg:e.errMsg.replace("chooseFile:fail",H)})}})}))}(t),t)}const te=e=>{const a=e.lastIndexOf("."),l=e.length;return{name:e.substring(0,a),ext:e.substring(a+1,l)}},se=e=>{if(Array.isArray(e))return e;return e.replace(/(\[|\])/g,"").split(",")},ie=async(e,a="image")=>{const l=te(e.name).ext.toLowerCase();let t={name:e.name,uuid:e.uuid,extname:l||"",cloudPath:e.cloudPath,fileType:e.fileType,url:e.path||e.path,size:e.size,image:{},path:e.path,video:{}};if("image"===a){const a=await(i=e.path,new Promise(((e,a)=>{s({src:i,success(a){e(a)},fail(e){a(e)}})})));delete t.video,t.image.width=a.width,t.image.height=a.height,t.image.location=a.path}else delete t.image;var i;return t};var re=K({name:"uniFilePicker",components:{uploadImage:K({name:"uploadImage",emits:["uploadFiles","choose","delFile"],props:{filesList:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1},disablePreview:{type:Boolean,default:!1},limit:{type:[Number,String],default:9},imageStyles:{type:Object,default:()=>({width:"auto",height:"auto",border:{}})},delIcon:{type:Boolean,default:!0},readonly:{type:Boolean,default:!1}},computed:{styles(){return Object.assign({width:"auto",height:"auto",border:{}},this.imageStyles)},boxStyle(){const{width:e="auto",height:a="auto"}=this.styles;let l={};"auto"===a?"auto"!==e?(l.height=this.value2px(e),l["padding-top"]=0):l.height=0:(l.height=this.value2px(a),l["padding-top"]=0),l.width="auto"===e?"auto"!==a?this.value2px(a):"33.3%":this.value2px(e);let t="";for(let s in l)t+=`${s}:${l[s]};`;return t},borderStyle(){let{border:e}=this.styles,a={};if("boolean"==typeof e)a.border=e?"1px #eee solid":"none";else{let l=e&&e.width||1;l=this.value2px(l);let t=e&&e.radius||3;t=this.value2px(t),a={"border-width":l,"border-style":e&&e.style||"solid","border-color":e&&e.color||"#eee","border-radius":t}}let l="";for(let t in a)l+=`${t}:${a[t]};`;return l}},methods:{uploadFiles(e,a){this.$emit("uploadFiles",e)},choose(){this.$emit("choose")},delFile(e){this.$emit("delFile",e)},prviewImage(e,a){let l=[];1===Number(this.limit)&&this.disablePreview&&!this.disabled&&this.$emit("choose"),this.disablePreview||(this.filesList.forEach((e=>{l.push(e.url)})),i({urls:l,current:a}))},value2px:e=>("number"==typeof e?e+="px":-1===e.indexOf("%")&&(e=-1!==e.indexOf("px")?e:e+"px"),e)}},[["render",function(e,a,l,t,s,i){const S=b,_=w,v=k;return r(),o(_,{class:"uni-file-picker__container"},{default:d((()=>[(r(!0),u(g,null,n(l.filesList,((e,a)=>(r(),o(_,{class:"file-picker__box",key:a,style:c(i.boxStyle)},{default:d((()=>[h(_,{class:"file-picker__box-content",style:c(i.borderStyle)},{default:d((()=>[h(S,{class:"file-image",src:e.url,mode:"aspectFill",onClick:m((l=>i.prviewImage(e,a)),["stop"])},null,8,["src","onClick"]),l.delIcon&&!l.readonly?(r(),o(_,{key:0,class:"icon-del-box",onClick:m((e=>i.delFile(a)),["stop"])},{default:d((()=>[h(_,{class:"icon-del"}),h(_,{class:"icon-del rotate"})])),_:2},1032,["onClick"])):p("",!0),e.progress&&100!==e.progress||0===e.progress?(r(),o(_,{key:1,class:"file-picker__progress"},{default:d((()=>[h(v,{class:"file-picker__progress-item",percent:-1===e.progress?0:e.progress,"stroke-width":"4",backgroundColor:e.errMsg?"#ff5a5f":"#EBEBEB"},null,8,["percent","backgroundColor"])])),_:2},1024)):p("",!0),e.errMsg?(r(),o(_,{key:2,class:"file-picker__mask",onClick:m((l=>i.uploadFiles(e,a)),["stop"])},{default:d((()=>[f(" 点击重试 ")])),_:2},1032,["onClick"])):p("",!0)])),_:2},1032,["style"])])),_:2},1032,["style"])))),128)),l.filesList.length<l.limit&&!l.readonly?(r(),o(_,{key:0,class:"file-picker__box",style:c(i.boxStyle)},{default:d((()=>[h(_,{class:"file-picker__box-content is-add",style:c(i.borderStyle),onClick:i.choose},{default:d((()=>[y(e.$slots,"default",{},(()=>[h(_,{class:"icon-add"}),h(_,{class:"icon-add rotate"})]),!0)])),_:3},8,["style","onClick"])])),_:3},8,["style"])):p("",!0)])),_:3})}],["__scopeId","data-v-670b1c05"]]),uploadFile:K({name:"uploadFile",emits:["uploadFiles","choose","delFile"],props:{filesList:{type:Array,default:()=>[]},delIcon:{type:Boolean,default:!0},limit:{type:[Number,String],default:9},showType:{type:String,default:""},listStyles:{type:Object,default:()=>({border:!0,dividline:!0,borderStyle:{}})},readonly:{type:Boolean,default:!1}},computed:{list(){let e=[];return this.filesList.forEach((a=>{e.push(a)})),e},styles(){return Object.assign({border:!0,dividline:!0,"border-style":{}},this.listStyles)},borderStyle(){let{borderStyle:e,border:a}=this.styles,l={};if(a){let a=e&&e.width||1;a=this.value2px(a);let t=e&&e.radius||5;t=this.value2px(t),l={"border-width":a,"border-style":e&&e.style||"solid","border-color":e&&e.color||"#eee","border-radius":t}}else l.border="none";let t="";for(let s in l)t+=`${s}:${l[s]};`;return t},borderLineStyle(){let e={},{borderStyle:a}=this.styles;if(a&&a.color&&(e["border-color"]=a.color),a&&a.width){let l=a&&a.width||1,t=a&&a.style||0;"number"==typeof l?l+="px":l=l.indexOf("px")?l:l+"px",e["border-width"]=l,"number"==typeof t?t+="px":t=t.indexOf("px")?t:t+"px",e["border-top-style"]=t}let l="";for(let t in e)l+=`${t}:${e[t]};`;return l}},methods:{uploadFiles(e,a){this.$emit("uploadFiles",{item:e,index:a})},choose(){this.$emit("choose")},delFile(e){this.$emit("delFile",e)},value2px:e=>("number"==typeof e?e+="px":e=-1!==e.indexOf("px")?e:e+"px",e)}},[["render",function(e,a,l,t,s,i){const b=w,v=k;return r(),o(b,{class:"uni-file-picker__files"},{default:d((()=>[l.readonly?p("",!0):(r(),o(b,{key:0,class:"files-button",onClick:i.choose},{default:d((()=>[y(e.$slots,"default",{},void 0,!0)])),_:3},8,["onClick"])),i.list.length>0?(r(),o(b,{key:1,class:"uni-file-picker__lists is-text-box",style:c(i.borderStyle)},{default:d((()=>[(r(!0),u(g,null,n(i.list,((e,a)=>(r(),o(b,{class:S(["uni-file-picker__lists-box",{"files-border":0!==a&&i.styles.dividline}]),key:a,style:c(0!==a&&i.styles.dividline&&i.borderLineStyle)},{default:d((()=>[h(b,{class:"uni-file-picker__item"},{default:d((()=>[h(b,{class:"files__name"},{default:d((()=>[f(_(e.name),1)])),_:2},1024),l.delIcon&&!l.readonly?(r(),o(b,{key:0,class:"icon-del-box icon-files",onClick:e=>i.delFile(a)},{default:d((()=>[h(b,{class:"icon-del icon-files"}),h(b,{class:"icon-del rotate"})])),_:2},1032,["onClick"])):p("",!0)])),_:2},1024),e.progress&&100!==e.progress||0===e.progress?(r(),o(b,{key:0,class:"file-picker__progress"},{default:d((()=>[h(v,{class:"file-picker__progress-item",percent:-1===e.progress?0:e.progress,"stroke-width":"4",backgroundColor:e.errMsg?"#ff5a5f":"#EBEBEB"},null,8,["percent","backgroundColor"])])),_:2},1024)):p("",!0),"error"===e.status?(r(),o(b,{key:1,class:"file-picker__mask",onClick:m((l=>i.uploadFiles(e,a)),["stop"])},{default:d((()=>[f(" 点击重试 ")])),_:2},1032,["onClick"])):p("",!0)])),_:2},1032,["class","style"])))),128))])),_:1},8,["style"])):p("",!0)])),_:3})}],["__scopeId","data-v-3c2aa2c9"]])},options:{virtualHost:!0},emits:["select","success","fail","progress","delete","update:modelValue","input"],props:{modelValue:{type:[Array,Object],default:()=>[]},disabled:{type:Boolean,default:!1},disablePreview:{type:Boolean,default:!1},delIcon:{type:Boolean,default:!0},autoUpload:{type:Boolean,default:!0},limit:{type:[Number,String],default:9},mode:{type:String,default:"grid"},fileMediatype:{type:String,default:"image"},fileExtname:{type:[Array,String],default:()=>[]},title:{type:String,default:""},listStyles:{type:Object,default:()=>({border:!0,dividline:!0,borderStyle:{}})},imageStyles:{type:Object,default:()=>({width:"auto",height:"auto"})},readonly:{type:Boolean,default:!1},returnType:{type:String,default:"array"},sizeType:{type:Array,default:()=>["original","compressed"]},sourceType:{type:Array,default:()=>["album","camera"]}},data:()=>({files:[],localValue:[]}),watch:{modelValue:{handler(e,a){this.setValue(e,a)},immediate:!0}},computed:{filesList(){let e=[];return this.files.forEach((a=>{e.push(a)})),e},showType(){return"image"===this.fileMediatype?this.mode:"list"},limitLength(){return"object"===this.returnType?1:this.limit?this.limit>=9?9:this.limit:1}},created(){Y.config&&Y.config.provider||(this.noSpace=!0,Y.chooseAndUploadFile=le),this.form=this.getForm("uniForms"),this.formItem=this.getForm("uniFormsItem"),this.form&&this.formItem&&this.formItem.name&&(this.rename=this.formItem.name,this.form.inputChildrens.push(this))},methods:{clearFiles(e){0===e||e?this.files.splice(e,1):(this.files=[],this.$nextTick((()=>{this.setEmit()}))),this.$nextTick((()=>{this.setEmit()}))},upload(){let e=[];return this.files.forEach(((a,l)=>{"ready"!==a.status&&"error"!==a.status||e.push(Object.assign({},a))})),this.uploadFiles(e)},async setValue(e,a){const l=async e=>{let a="";return a=e.fileID?e.fileID:e.url,/cloud:\/\/([\w.]+\/?)\S*/.test(a)&&(e.fileID=a,e.url=await this.getTempFileURL(a)),e.url&&(e.path=e.url),e};if("object"===this.returnType)e?await l(e):e={};else{e||(e=[]);for(let a=0;a<e.length;a++){let t=e[a];await l(t)}}this.localValue=e,this.form&&this.formItem&&!this.is_reset&&(this.is_reset=!1,this.formItem.setValue(this.localValue));let t=Object.keys(e).length>0?e:[];this.files=[].concat(t)},choose(){this.disabled||(this.files.length>=Number(this.limitLength)&&"grid"!==this.showType&&"array"===this.returnType?t({title:`您最多选择 ${this.limitLength} 个文件`,icon:"none"}):this.chooseFiles())},chooseFiles(){const e=se(this.fileExtname);Y.chooseAndUploadFile({type:this.fileMediatype,compressed:!1,sizeType:this.sizeType,sourceType:this.sourceType,extension:e.length>0?e:void 0,count:this.limitLength-this.files.length,onChooseFile:this.chooseFileCallback,onUploadProgress:e=>{this.setProgress(e,e.index)}}).then((e=>{this.setSuccessAndError(e.tempFiles)})).catch((e=>{console.log("选择失败",e)}))},async chooseFileCallback(e){const a=se(this.fileExtname);(1===Number(this.limitLength)&&this.disablePreview&&!this.disabled||"object"===this.returnType)&&(this.files=[]);let{filePaths:l,files:s}=((e,a)=>{let l=[],s=[];return a&&0!==a.length?(e.tempFiles.forEach((e=>{const t=te(e.name).ext.toLowerCase();-1!==a.indexOf(t)&&(s.push(e),l.push(e.path))})),s.length!==e.tempFiles.length&&t({title:`当前选择了${e.tempFiles.length}个文件 ，${e.tempFiles.length-s.length} 个文件格式不正确`,icon:"none",duration:5e3}),{filePaths:l,files:s}):{filePaths:l,files:s}})(e,a);a&&a.length>0||(l=e.tempFilePaths,s=e.tempFiles);let i=[];for(let t=0;t<s.length&&!(this.limitLength-this.files.length<=0);t++){s[t].uuid=Date.now();let e=await ie(s[t],this.fileMediatype);e.progress=0,e.status="ready",this.files.push(e),i.push({...e,file:s[t]})}this.$emit("select",{tempFiles:i,tempFilePaths:l}),e.tempFiles=s,this.autoUpload&&!this.noSpace||(e.tempFiles=[])},uploadFiles(e){return e=[].concat(e),ee.call(this,e,5,(e=>{this.setProgress(e,e.index,!0)})).then((e=>(this.setSuccessAndError(e),e))).catch((e=>{console.log(e)}))},async setSuccessAndError(e,a){let l=[],t=[],s=[],i=[];for(let r=0;r<e.length;r++){const a=e[r],o=a.uuid?this.files.findIndex((e=>e.uuid===a.uuid)):a.index;if(-1===o||!this.files)break;if("request:fail"===a.errMsg)this.files[o].url=a.path,this.files[o].status="error",this.files[o].errMsg=a.errMsg,t.push(this.files[o]),i.push(this.files[o].url);else{this.files[o].errMsg="",this.files[o].fileID=a.url;/cloud:\/\/([\w.]+\/?)\S*/.test(a.url)?this.files[o].url=await this.getTempFileURL(a.url):this.files[o].url=a.url,this.files[o].status="success",this.files[o].progress+=1,l.push(this.files[o]),s.push(this.files[o].fileID)}}l.length>0&&(this.setEmit(),this.$emit("success",{tempFiles:this.backObject(l),tempFilePaths:s})),t.length>0&&this.$emit("fail",{tempFiles:this.backObject(t),tempFilePaths:i})},setProgress(e,a,l){this.files.length;const t=Math.round(100*e.loaded/e.total);let s=a;l||(s=this.files.findIndex((a=>a.uuid===e.tempFile.uuid))),-1!==s&&this.files[s]&&(this.files[s].progress=t-1,this.$emit("progress",{index:s,progress:parseInt(t),tempFile:this.files[s]}))},delFile(e){this.$emit("delete",{tempFile:this.files[e],tempFilePath:this.files[e].url}),this.files.splice(e,1),this.$nextTick((()=>{this.setEmit()}))},getFileExt(e){const a=e.lastIndexOf("."),l=e.length;return{name:e.substring(0,a),ext:e.substring(a+1,l)}},setEmit(){let e=[];"object"===this.returnType?(e=this.backObject(this.files)[0],this.localValue=e||null):(e=this.backObject(this.files),this.localValue||(this.localValue=[]),this.localValue=[...e]),this.$emit("update:modelValue",this.localValue)},backObject(e){let a=[];return e.forEach((e=>{a.push({extname:e.extname,fileType:e.fileType,image:e.image,name:e.name,path:e.path,size:e.size,fileID:e.fileID,url:e.url})})),a},async getTempFileURL(e){e={fileList:[].concat(e)};return(await Y.getTempFileURL(e)).fileList[0].tempFileURL||""},getForm(e="uniForms"){let a=this.$parent,l=a.$options.name;for(;l!==e;){if(a=a.$parent,!a)return!1;l=a.$options.name}return a}}},[["render",function(e,a,l,t,s,i){const u=M,n=w,c=v("upload-image"),m=F,g=v("upload-file");return r(),o(n,{class:"uni-file-picker"},{default:d((()=>[l.title?(r(),o(n,{key:0,class:"uni-file-picker__header"},{default:d((()=>[h(u,{class:"file-title"},{default:d((()=>[f(_(l.title),1)])),_:1}),h(u,{class:"file-count"},{default:d((()=>[f(_(i.filesList.length)+"/"+_(i.limitLength),1)])),_:1})])),_:1})):p("",!0),"image"===l.fileMediatype&&"grid"===i.showType?(r(),o(c,{key:1,readonly:l.readonly,"image-styles":l.imageStyles,"files-list":i.filesList,limit:i.limitLength,disablePreview:l.disablePreview,delIcon:l.delIcon,onUploadFiles:i.uploadFiles,onChoose:i.choose,onDelFile:i.delFile},{default:d((()=>[y(e.$slots,"default",{},(()=>[h(n,{class:"is-add"},{default:d((()=>[h(n,{class:"icon-add"}),h(n,{class:"icon-add rotate"})])),_:1})]),!0)])),_:3},8,["readonly","image-styles","files-list","limit","disablePreview","delIcon","onUploadFiles","onChoose","onDelFile"])):p("",!0),"image"!==l.fileMediatype||"grid"!==i.showType?(r(),o(g,{key:2,readonly:l.readonly,"list-styles":l.listStyles,"files-list":i.filesList,showType:i.showType,delIcon:l.delIcon,onUploadFiles:i.uploadFiles,onChoose:i.choose,onDelFile:i.delFile},{default:d((()=>[y(e.$slots,"default",{},(()=>[h(m,{type:"primary",size:"mini"},{default:d((()=>[f("选择文件")])),_:1})]),!0)])),_:3},8,["readonly","list-styles","files-list","showType","delIcon","onUploadFiles","onChoose","onDelFile"])):p("",!0)])),_:3})}],["__scopeId","data-v-ff6727b0"]]),oe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACaUlEQVRYR8WXu28TQRDGv29lW+ElKEBAGQENSIBoADf22h3gCiEeLeEPSBNKoDQUUJPQAgV0QHfes2SZpEGIAgqQKBGCAmQS8Fm6QXu5Q+fgxHfOwbmzbnbmt/PaGSLhzxizHcBZABrAcZLTIrLTHif5XUQ+AngNwAB4rrX+kUQ1xwkZYw4CuA7gMoBt4+TD78sAHgFoaq0/bHRmXQBjzBSAmyRnRaSU0PCQGEkPwD0RuaG1/jVKx0gAx3EOKKWeWFdPYnjEGRuaC6O88ReA4zgnlFIvAOzNyHik5rPv+2fq9fqruN4hgDDeXQB7MjYeqfsCoBz3xB+Abre7pd/vvwRw7B8ZD9SSfFMqlU6Vy+Wfwf/ImOu6TRGZS2pca73We5L0LMnb1WrVVtYqQJh07wAUkyrZDACAAYDDNhQBgDFmHsBMUuNWbpMAVsUDrfUMO53OjsFg8ClFkwk4MwBYLhaL+2mMuQjgcZrbZwRg1Vxiq9W6T/JaHgAiMm89sAjgZB4AAJYsgG0Ou3MC+ErXdfuTPDYZJKFtSl7+ALmHYNIkTJsz68gvTVyGWQBEZThRI8oCIGhEebVikiuFQmFf9BgtALia5lYZlOHqYxS+hnbyffs/n2Ol1JFKpfI+l4FERO7UarVg+BkayTzPWxSRo2lCkVbWjmS9Xu90o9FYGQKIhSKfoTS6Sa5jeQRhx3OST7MKh3W7iJxPtJjEIKZI3hKR2TTVsSYnBiTvpl7N4kra7fYh3/fnSF4Rka0Jk87O/A+VUk1bahudGbsdxzxi1/NzJIP1XESmAewKv38jGaznImLX82dJ1/PfAQE7fh1A9VcAAAAASUVORK5CYII=";var de=K(I({name:"",components:{},props:{id:{type:String,default:""}},setup(e,a){const l=C(null),s=C(null),i=C(null),r=C(null),o=W(),d=A({rules:{materialManagerId:{rules:[{required:!0,errorMessage:"物料编码不能为空"}]},doorwayTime:{rules:[{required:!0,errorMessage:"出入库日期不能为空"}]},itemNumber:{rules:[{required:!0,errorMessage:"数量不能为空"},{format:"number",errorMessage:"数量只能输入数字"}]},dataNature:{rules:[{required:!0,errorMessage:"数据性质不能为空"}]}},searchmaterialCodeName:"",searchWarehouseShelveName:"",labelWidth:90,dataNatureList:[],fileList:[]}),u=x((()=>{let e=[],a=o.state.warehouseManage.stockSellStorage.materialCodeList.list,l=new RegExp(`${d.searchmaterialCodeName.split("").join(".*")}`,"i");for(let t of a)l.test(t.materialCode)&&e.push(t);return e})),n=x((()=>o.state.warehouseManage.stockSellStorage.materialManagerDetailInfo)),c=x((()=>o.state.warehouseManage.warehouseSystem.filterSearch.allShelves.filter((e=>{if(e.label)return e.label.includes(d.searchWarehouseShelveName)})))),h=x((()=>o.state.warehouseManage.stockSellStorage.dataNature)),m=x((()=>o.state.warehouseManage.stockSellStorage.materialCodeList.curMaterialCodeItem)),p=x((()=>o.state.warehouseManage.stockSellStorage.warehouseShelveList.curWarehouseShelveItem)),f=x((()=>o.state.warehouseManage.stockSellStorage.addParams)),g=(e,a)=>{e[a?"open":"close"]()},y=e=>o.dispatch(`warehouseManage/stockSellStorage/${P.GetMaterialManagerDetailInfoMobile}`,e),b=e=>o.dispatch(`warehouseManage/stockSellStorage/${P.FindMaterialCodeList}`,e),w=e=>o.dispatch(`warehouseManage/warehouseSystem/${N.GetAllShelves}`,e);return b(),w(),d.dataNatureList=h.value.outlist,e.id?(V({title:"编辑进销存"}),y({id:e.id}).then((e=>{e&&(o.commit(`warehouseManage/stockSellStorage/${T.UpdateAddParams}`,{materialManagerId:n.value.materialManagerId,itemNumber:n.value.itemNumber,itemPrice:n.value.itemPrice,orderNo:n.value.orderNo,realMouldNo:n.value.realMouldNo,doorwayTime:L(n.value.doorwayTime).format("YYYY-MM-DD"),purchaseDetail:n.value.purchaseDetail,warehouseShelvesId:n.value.warehouseShelvesId,remark:n.value.remark,dataType:n.value.dataType,dataNature:n.value.dataNature,fileIds:n.value.fileIds}),d.fileList=n.value.fileInfoList.map((e=>Object.assign({url:B+e.filePath},e))),o.commit(`warehouseManage/stockSellStorage/${T.UpdateMaterialCodeList}`,{curMaterialCodeItem:u.value.find((e=>e.materialManagerId==n.value.materialManagerId))}),1==n.value.dataType?d.dataNatureList=h.value.enterlist:d.dataNatureList=h.value.outlist,o.commit(`warehouseManage/stockSellStorage/${T.UpdateDataNature}`,{curDataNature:d.dataNatureList.find((e=>e.value==n.value.dataNature)),tabCurrent:2==Number(n.value.dataType)?0:1}),o.commit(`warehouseManage/stockSellStorage/${T.UpdateWarehouseShelveList}`,{curWarehouseShelveItem:c.value.find((e=>e.value==n.value.warehouseShelvesId))}))}))):o.dispatch(`warehouseManage/stockSellStorage/${P.InitMaterialManagerForm}`),{Tool:U,BASE_IMAGE_URL:B,valiForm:l,popMaterialCodeRef:s,popDataNatureRef:i,popWarehouseShelveRef:r,materialCodeList:u,materialManagerDetailInfo:n,getMaterialManagerDetailInfoMobile:y,curMaterialCodeItem:m,warehouseShelveList:c,curWarehouseShelveItem:p,addParams:f,togglePopup:g,onClickItem:e=>{d.dataNatureList=0==e.currentIndex?h.value.outlist:h.value.enterlist,o.commit(`warehouseManage/stockSellStorage/${T.UpdateDataNature}`,{tabCurrent:e.currentIndex})},dataNature:h,getAllShelves:w,handleMaterialCodeClick:e=>{o.commit(`warehouseManage/stockSellStorage/${T.UpdateMaterialCodeList}`,{curMaterialCodeItem:e}),o.commit(`warehouseManage/stockSellStorage/${T.UpdateAddParams}`,{materialManagerId:e.materialManagerId,itemPrice:e.materialAverageNum}),l.value.setValue("materialManagerId",e.materialManagerId),g(s.value,!1)},handleDataNatureClick:e=>{o.commit(`warehouseManage/stockSellStorage/${T.UpdateDataNature}`,{curDataNature:e}),o.commit(`warehouseManage/stockSellStorage/${T.UpdateAddParams}`,{dataType:0==Number(h.value.tabCurrent)?2:1,dataNature:e.value}),l.value.setValue("dataNature",e.value),g(i.value,!1)},handleWarehouseShelveClick:e=>{o.commit(`warehouseManage/stockSellStorage/${T.UpdateWarehouseShelveList}`,{curWarehouseShelveItem:e}),o.commit(`warehouseManage/stockSellStorage/${T.UpdateAddParams}`,{warehouseShelvesId:e.value}),g(r.value,!1)},findMaterialCodeList:b,uploadFiles:(e,a)=>{o.dispatch(`warehouseManage/stockSellStorage/${P.UploadFiles}`,{files:{files:e.tempFiles},key:a}),e.tempFiles.map((e=>{d.fileList.push({name:e.name,url:e.path})}))},deleteFiles:e=>{let a=d.fileList.findIndex((a=>a.url==e.tempFilePath)),l=f.value.fileIds.split(",");l.splice(a,1),o.commit(`warehouseManage/stockSellStorage/${T.UpdateAddParams}`,{fileIds:l.join()})},submit:a=>{l.value.validate().then((l=>{t({title:"校验通过"}),e.id?o.dispatch(`warehouseManage/stockSellStorage/${P.EditMaterialManagerDetail}`,{id:e.id}):o.dispatch(`warehouseManage/stockSellStorage/${P.AddMaterialManagerDetail}`,a)})).catch((e=>{console.log("err",e)}))},...D(d)}}}),[["render",function(e,a,l,t,s,i){const c=M,m=E(O("uni-icons"),j),y=w,b=E(O("uni-forms-item"),R),k=E(O("uni-datetime-picker"),Q),v=E(O("uni-easyinput"),z),I=E(O("uni-file-picker"),re),C=E(O("uni-forms"),G),A=F,x=E(O("uni-search-bar"),q),P=E(O("uni-popup"),Z),N=E(O("uni-segmented-control"),J);return r(),o(y,{class:"main uni-forms-reset"},{default:d((()=>[h(C,{ref:"valiForm",class:"uni-forms",rules:e.rules,modelValue:e.addParams},{default:d((()=>[h(b,{label:"物料编码","label-width":e.labelWidth,required:"",name:"materialManagerId"},{default:d((()=>[h(y,{class:S({select:!0,"not-value":!e.curMaterialCodeItem.materialManagerId}),onClick:a[0]||(a[0]=a=>e.togglePopup(e.popMaterialCodeRef,!0))},{default:d((()=>[h(c,{class:"name"},{default:d((()=>[f(_(e.curMaterialCodeItem.materialCode),1)])),_:1}),h(y,null,{default:d((()=>[h(m,{type:"forward",size:"14",color:"#BFBFBF"})])),_:1})])),_:1},8,["class"])])),_:1},8,["label-width"]),e.curMaterialCodeItem.materialManagerId?(r(),o(y,{key:0,class:"look-detail",onClick:a[1]||(a[1]=a=>e.Tool.navigateTo(`/pages/menus/warehouseManage/warehouseSystem/inventory/detail/index?id=${e.curMaterialCodeItem.materialManagerId}`))},{default:d((()=>[$("img",{class:"icon-detail",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAaCAYAAACtv5zzAAAAwklEQVRIS2M8cOCA5////+cyMDBIMlAXPGdkZExm3L9//zMaGA5z6nOQBf+p63BU04ahBf///69+8+ZND8ijIiIiJYyMjK0wsbCwsF+4gnPVqlVsMPXIajCC6PXr1+wwg/bv38/DwMDwGVkMX3zB1OO1AOZaJSWl/58+fSol1gdnzpxhhanHawG1U9RoKoKH6GgqIjtxjaai0VREduKBaxyGqYjyQMGs9GnZbHnBuG/fPi9GRkZQw0uCyq5/+v///zQA+K4bpluNlc8AAAAASUVORK5CYII=",alt:"",srcset:""}),h(c,null,{default:d((()=>[f("查看物料详情")])),_:1})])),_:1})):p("",!0),e.curMaterialCodeItem.materialManagerId?(r(),o(y,{key:1,class:"block"})):p("",!0),h(b,{label:"出入库日期","label-width":e.labelWidth,required:"",name:"doorwayTime"},{default:d((()=>[h(k,{type:"date","return-type":"string",modelValue:e.addParams.doorwayTime,"onUpdate:modelValue":a[2]||(a[2]=a=>e.addParams.doorwayTime=a)},null,8,["modelValue"])])),_:1},8,["label-width"]),h(b,{label:"单位","label-width":e.labelWidth},{default:d((()=>[h(y,{class:"no-edit"},{default:d((()=>[h(y,{class:"left"},{default:d((()=>[f(_(e.curMaterialCodeItem.measureUnit||"--"),1)])),_:1}),h(y,{class:"right"},{default:d((()=>[$("img",{class:"icon-tips",src:oe,alt:"",srcset:""}),h(c,null,{default:d((()=>[f("该项不可编辑")])),_:1})])),_:1})])),_:1})])),_:1},8,["label-width"]),h(b,{label:"数量","label-width":e.labelWidth,name:"itemNumber"},{default:d((()=>[h(v,{modelValue:e.addParams.itemNumber,"onUpdate:modelValue":a[3]||(a[3]=a=>e.addParams.itemNumber=a),"label-width":e.labelWidth,inputBorder:!1,clearable:!1,required:"",placeholder:"请输入数量"},null,8,["modelValue","label-width"])])),_:1},8,["label-width"]),h(b,{label:"单价","label-width":e.labelWidth},{default:d((()=>[h(v,{modelValue:e.addParams.itemPrice,"onUpdate:modelValue":a[4]||(a[4]=a=>e.addParams.itemPrice=a),"label-width":e.labelWidth,inputBorder:!1,clearable:!1,placeholder:"请输入单价"},null,8,["modelValue","label-width"])])),_:1},8,["label-width"]),h(b,{label:"金额","label-width":e.labelWidth},{default:d((()=>[h(y,{class:"no-edit"},{default:d((()=>[h(y,{class:"left"},{default:d((()=>[f(_(Number(e.addParams.itemPrice)*Number(e.addParams.itemNumber)||0),1)])),_:1}),h(y,{class:"right"},{default:d((()=>[$("img",{class:"icon-tips",src:oe,alt:"",srcset:""}),h(c,null,{default:d((()=>[f("该项不可编辑")])),_:1})])),_:1})])),_:1})])),_:1},8,["label-width"]),h(b,{label:"数据性质","label-width":e.labelWidth,required:"",name:"dataNature"},{default:d((()=>[h(y,{class:S({select:!0,"not-value":!e.dataNature.curDataNature.value}),onClick:a[5]||(a[5]=a=>e.togglePopup(e.popDataNatureRef,!0))},{default:d((()=>[h(y,{class:"name"},{default:d((()=>[e.dataNature.curDataNature.value?(r(),o(y,{key:0},{default:d((()=>[f(_(0==e.dataNature.tabCurrent?"出库/":"入库/")+_(e.dataNature.curDataNature.value),1)])),_:1})):p("",!0)])),_:1}),h(y,null,{default:d((()=>[h(m,{type:"forward",size:"14",color:"#BFBFBF"})])),_:1})])),_:1},8,["class"])])),_:1},8,["label-width"]),h(b,{label:"关联订单","label-width":e.labelWidth},{default:d((()=>[h(v,{modelValue:e.addParams.orderNo,"onUpdate:modelValue":a[6]||(a[6]=a=>e.addParams.orderNo=a),"label-width":e.labelWidth,inputBorder:!1,clearable:!1,placeholder:"请输入关联订单"},null,8,["modelValue","label-width"])])),_:1},8,["label-width"]),h(b,{label:"关联模具","label-width":e.labelWidth},{default:d((()=>[h(v,{modelValue:e.addParams.realMouldNo,"onUpdate:modelValue":a[7]||(a[7]=a=>e.addParams.realMouldNo=a),"label-width":e.labelWidth,inputBorder:!1,clearable:!1,placeholder:"请输入关联模具"},null,8,["modelValue","label-width"])])),_:1},8,["label-width"]),h(b,{label:"关联采购单","label-width":e.labelWidth},{default:d((()=>[h(v,{modelValue:e.addParams.purchaseDetail,"onUpdate:modelValue":a[8]||(a[8]=a=>e.addParams.purchaseDetail=a),"label-width":e.labelWidth,inputBorder:!1,clearable:!1,placeholder:"请输入关联采购单"},null,8,["modelValue","label-width"])])),_:1},8,["label-width"]),h(b,{label:"库存位置","label-width":e.labelWidth,name:"warehouseShelvesId"},{default:d((()=>[h(y,{class:S({select:!0,"not-value":!e.curWarehouseShelveItem.value}),onClick:a[9]||(a[9]=a=>e.togglePopup(e.popWarehouseShelveRef,!0))},{default:d((()=>[h(c,{class:"name"},{default:d((()=>[f(_(e.curWarehouseShelveItem.label),1)])),_:1}),h(y,null,{default:d((()=>[h(m,{type:"forward",size:"14",color:"#BFBFBF"})])),_:1})])),_:1},8,["class"])])),_:1},8,["label-width"]),h(b,{label:"相关照片","label-width":e.labelWidth,name:"fileIds"},{default:d((()=>[h(y,{class:"upload-image"},{default:d((()=>[h(I,{limit:"9",modelValue:e.fileList,"onUpdate:modelValue":a[10]||(a[10]=a=>e.fileList=a),"return-type":"array",onSelect:a[11]||(a[11]=a=>e.uploadFiles(a,"fileIds")),onDelete:a[12]||(a[12]=a=>e.deleteFiles(a))},null,8,["modelValue"])])),_:1})])),_:1},8,["label-width"]),h(b,{label:"备注","label-width":e.labelWidth,name:"remark"},{default:d((()=>[h(v,{type:"textarea",modelValue:e.addParams.remark,"onUpdate:modelValue":a[13]||(a[13]=a=>e.addParams.remark=a),placeholder:"请输入"},null,8,["modelValue"])])),_:1},8,["label-width"])])),_:1},8,["rules","modelValue"]),h(y,{class:"fix-footer"},{default:d((()=>[h(A,{type:"primary",class:"btn-confirm btn-primary",onClick:a[14]||(a[14]=a=>e.submit("valiForm"))},{default:d((()=>[f("提交")])),_:1})])),_:1}),h(P,{ref:"popMaterialCodeRef","background-color":"#fff",type:"bottom"},{default:d((()=>[h(y,{class:"material-popup-warpper"},{default:d((()=>[h(y,{class:"header"},{default:d((()=>[h(c,{class:"title"},{default:d((()=>[f("物料编码")])),_:1}),h(y,null,{default:d((()=>[h(m,{type:"closeempty",size:"16",onClick:a[15]||(a[15]=a=>e.togglePopup(e.popMaterialCodeRef,!1))})])),_:1})])),_:1}),h(y,{class:"search-section"},{default:d((()=>[h(x,{modelValue:e.searchmaterialCodeName,"onUpdate:modelValue":a[16]||(a[16]=a=>e.searchmaterialCodeName=a),cancelButton:"none",placeholder:"请输入物料名称"},null,8,["modelValue"])])),_:1}),h(y,{class:"dia-main"},{default:d((()=>[e.materialCodeList.length?(r(!0),u(g,{key:0},n(e.materialCodeList,(a=>(r(),o(y,{class:S({item:!0}),key:a.materialManagerId,onClick:l=>e.handleMaterialCodeClick(a)},{default:d((()=>[h(c,null,{default:d((()=>[f(_(a.materialCode),1)])),_:2},1024),e.curMaterialCodeItem.materialManagerId===a.materialManagerId?(r(),o(y,{key:0,class:"icon"},{default:d((()=>[h(m,{type:"checkmarkempty",size:"18",color:"#3A78F4"})])),_:1})):p("",!0)])),_:2},1032,["onClick"])))),128)):(r(),o(y,{key:1,class:"not-found"},{default:d((()=>[f(" 未找到 "),h(c,null,{default:d((()=>[f("“"+_(e.searchmaterialCodeName)+"“",1)])),_:1}),f(" 材料 ")])),_:1}))])),_:1})])),_:1})])),_:1},512),h(P,{ref:"popDataNatureRef","background-color":"#fff",type:"bottom"},{default:d((()=>[h(y,{class:"material-popup-warpper"},{default:d((()=>[h(y,{class:"header"},{default:d((()=>[h(c,{class:"title"},{default:d((()=>[f("数据性质")])),_:1}),h(y,null,{default:d((()=>[h(m,{type:"closeempty",size:"16",onClick:a[17]||(a[17]=a=>e.togglePopup(e.popDataNatureRef,!1))})])),_:1})])),_:1}),h(y,{class:"tabs"},{default:d((()=>[h(N,{current:e.dataNature.tabCurrent,values:e.dataNature.tabItem,onClickItem:e.onClickItem,styleType:"text",activeColor:"#3A78F4 "},null,8,["current","values","onClickItem"])])),_:1}),h(y,{class:"dia-main"},{default:d((()=>[(r(!0),u(g,null,n(e.dataNatureList,((a,l)=>(r(),o(y,{class:S({item:!0}),key:l,onClick:l=>e.handleDataNatureClick(a)},{default:d((()=>[h(c,null,{default:d((()=>[f(_(a.value),1)])),_:2},1024),e.dataNature.curDataNature.value===a.value?(r(),o(y,{key:0,class:"icon"},{default:d((()=>[h(m,{type:"checkmarkempty",size:"18",color:"#3A78F4"})])),_:1})):p("",!0)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})])),_:1},512),h(P,{ref:"popWarehouseShelveRef","background-color":"#fff",type:"bottom"},{default:d((()=>[h(y,{class:"material-popup-warpper"},{default:d((()=>[h(y,{class:"header"},{default:d((()=>[h(c,{class:"title"},{default:d((()=>[f("库存位置")])),_:1}),h(y,null,{default:d((()=>[h(m,{type:"closeempty",size:"16",onClick:a[18]||(a[18]=a=>e.togglePopup(e.popWarehouseShelveRef,!1))})])),_:1})])),_:1}),h(y,{class:"search-section"},{default:d((()=>[h(x,{modelValue:e.searchWarehouseShelveName,"onUpdate:modelValue":a[19]||(a[19]=a=>e.searchWarehouseShelveName=a),cancelButton:"none",placeholder:"请输入位置名称"},null,8,["modelValue"])])),_:1}),h(y,{class:"dia-main"},{default:d((()=>[e.warehouseShelveList.length?(r(!0),u(g,{key:0},n(e.warehouseShelveList,(a=>(r(),o(y,{class:S({item:!0}),key:a.warehouseShelvesId,onClick:l=>e.handleWarehouseShelveClick(a)},{default:d((()=>[h(c,null,{default:d((()=>[f(_(a.label),1)])),_:2},1024),e.curWarehouseShelveItem.value===a.value?(r(),o(y,{key:0,class:"icon"},{default:d((()=>[h(m,{type:"checkmarkempty",size:"18",color:"#3A78F4"})])),_:1})):p("",!0)])),_:2},1032,["onClick"])))),128)):(r(),o(y,{key:1,class:"not-found"},{default:d((()=>[f(" 未找到 "),h(c,null,{default:d((()=>[f("“"+_(e.searchWarehouseShelveName)+"“",1)])),_:1}),f(" 仓库 ")])),_:1}))])),_:1})])),_:1})])),_:1},512)])),_:1})}],["__scopeId","data-v-145b7266"]]);export{de as default};
